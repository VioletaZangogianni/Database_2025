# Εξαμηνιαία Εργασία Βάσεων Δεδομένων 2025 


## Εισαγωγή

Στα πλαίσια του μαθήματος «Βάσεις Δεδομένων» του 6ου Εξαμήνου της Σχολής ΗΜΜΥ, κληθήκαμε να αναπτύξουμε μια βάση δεδομένων για το διεθνές φεστιβάλ μουσικής *Pulse University*. Αντικείμενο της εργασίας αποτελεί η μελέτη, ο σχεδιασμός και η υλοποίηση μιας βάσης που θα εξυπηρετεί το φεστιβάλ μουσικής, αφού θα αποθηκεύει και θα διαχειρίζεται πληροφορίες, απαραίτητες για την οργάνωση και την διεξαγωγή του.

Το φεστιβάλ αυτό είναι ετήσιο περιλαμβάνει παραστάσεις τόσο από καλλιτέχνες, όσο και από μπάντες σε διαφορετική τοποθεσία ανά έτος. Σκοπός της βάσης είναι η πλήρης παρακολούθηση της διοργάνωσης, από την συνολική οργάνωση του φεστιβάλ και των παραστάσεων του, μέχρι και την πώληση των εισιτηρίων και την αξιολόγηση των παραστάσεων από το κοινό.

Η εργασία υλοποιήθηκε χρησιμοποιώντας SQL σε σύστημα MySQL για τη δημιουργία του σχήματος, της εισαγωγής και της διαχείρισης των δεδομένων, όπως και για την απάντηση ερωτημάτων σχετικά με τη βάση (queries). Επίσης, χρησιμοποιήθηκε python για την αυτοματοποίηση δημιουργίας δεδομένων.


## Απαιτήσεις Βάσης Δεδομένων 

Αρχικά, για την υλοποίηση ήταν απαραίτητη η καταγραφή και η κατανόηση των απαιτήσεων του συστήματος βασισμένοι στην εκφώνηση της εργασίας.


- Κύριες Οντότητες 
    - festival: Τα φεστιβάλ που πραγματοποιούνται 
    - location: Τοποθεσία διεξαγωγής του φεστιβάλ
    - events: Παραστάσεις που γίνονται σε κάθε φεστιβάλ
    - staff: Προσωπικό που υποστηρίζει κάθε σκηνή σε κάθε παράσταση
    - performance: Σειριακές εμφανίσεις αποτελούν κάθε παράσταση
    - performers: Αυτοί που συμμετέχουν στο performance χωρίς διαχωρισμό σε καλλιτέχνη ή μπάντα
    - visitor: Επισκέπτες των φεστιβάλ
    - ticket: Εισιτήρια παραστάσεων
    - resaleQueue: Αυτόματη ουρά μεταπώλησης που λειτουργεί με FIFO
    - sellers: Πωλητές εισιτηρίων 
    - buyers: Αγοραστές εισιτηρίων sold-out παραστάσεων
    - reviews: Αξιολογήσεις κατόχων ενεργοποιημένων εισιτηρίων, που μπορούν να αξιολογήσουν με βάση τη κλίμακα Likert.

- Σχέσεις	
	- Ένα φεστιβάλ αποτελείται από πολλές παραστάσεις και γίνεται σε συγκεκριμένη τοποθεσία, διαφορετική κάθε χρονιά.
	- Κάθε παράσταση πραγματοποιείται σε μία σκηνή και περιλαμβάνει πολλές εμφανίσεις.
	- Κάθε εμφάνιση γίνεται από έναν καλλιτέχνη ή μπάντα.
	- Κάθε σκηνή απαιτεί συγκεκριμένο πλήθος προσωπικού ανά είδος προσωπικού ανά παράσταση.
	- Κάθε εισιτήριο αφορά έναν επισκέπτη και μία παράσταση.
	- Οι επισκέπτες μπορούν να κάνουν αξιολογήσεις για παραστάσεις στις οποίες παραβρέθηκαν.

- Κανόνες και περιορισμοί 
	- Τα φεστιβάλ είναι ετήσια και πραγματοποιούνται σε συναπτά έτη.
	- Το φεστιβάλ, αν είναι πολυήμερο, είναι σε συνεχόμενες ημέρες.
	- Κάθε σκηνή μπορεί να φιλοξενεί μόνο μια παράσταση κάθε χρονική στιγμή.
	- Το προσωπικό χαρακτηρίζεται από ένα επίπεδο εμπειρίας.
	- Το 5% της χωρητικότητας κάθε σκηνής πρέπει να είναι μικρότερο από το πλήθος του security προσωπικού, και το 2% του βοηθητικού προσωπικού.
	- Οι εμφανίσεις των καλλιτεχνών είναι σειριακές και ανάμεσα σε δύο διαδοχικές το διάλειμμα έχει διάρκεια 5 έως 30 λεπτών. Μέγιστη διάρκεια των εμφανίσεων είναι 3 ώρες.
	- Ως καλλιτέχνες ορίζονται είτε σόλο καλλιτέχνες είτε μέλη συγκροτημάτων.
	- Ένας καλλιτέχνης μπορεί να ανήκει σε παραπάνω από ένα συγκροτήματα.
	- Ένας καλλιτέχνης δεν μπορεί να εμφανίζεται σε 3 συναπτά φεστιβάλ.
	- Ένας επισκέπτης μπορεί να αγοράσει εισιτήρια για όσες μέρες του κάθε φεστιβάλ θέλει και το καθένα αναφέρεται σε συγκεκριμένη παράσταση. Δεν μπορεί, όμως να αγοράσει εισιτήρια για περισσότερες από μια παραστάσεις την ίδια ημέρα του φεστιβάλ, ούτε προφανώς για την ίδια παράσταση.
	- Οι τρόποι αγοράς των εισιτηρίων είναι είτε με χρεωστική κάρτα ή με πιστωτική ή με τραπεζικό λογαριασμό.
	- Κάθε εισιτήριο μπορεί να χρησιμοποιηθεί μόνο μια φορά, αφού γίνεται επικύρωση με την είσοδο του κάθε επισκέπτη στον χώρο της παράστασης.
	- Το κόστος των εισιτηρίων διαφέρει ανά ημέρα του φεστιβάλ.
	- Τα εισιτήρια VIP μπορούν να αποτελούν το πολύ το 10% της χωρητικότητας κάθε σκηνής.
	- Η ουρά μεταπώλησης ενεργοποιείται αυτόματα όταν γίνει sold-out ένα event.
	- Ένας ενδιαφερόμενος αγοραστής μπορεί να αναζητήσει εισιτήριο για συγκεκριμένη παράσταση και κατηγορία εισιτηρίου, είτε για συγκεκριμένο εισιτήριο.
	- Η πώληση εισιτηρίου πραγματοποιείται αυτόματα.
	- Η ουρά υλοποιείται με FIFO.
	- Οι χρηματικές συναλλαγές πραγματοποιούνται αυτόματα.
	- Μόνο οι κάτοχοι εισιτηρίων για συγκεκριμένη παράσταση μπορούν να αξιολογήσουν τη συγκεκριμένη παράσταση μια μόνο φορά.
	- Δεν υπάρχουν ακυρώσεις σε φεστιβάλ/παραστάσεις/εισιτήρια.

- Υποθέσεις και παραδοχές
	- Όλες οι ημέρες ενός φεστιβάλ πρέπει να ανήκουν στο ίδιο έτος. Δηλαδή, ένα φεστιβάλ δεν μπορεί να ξεκινάει τον Δεκέμβριο και να συνεχίζεται μέχρι τον Ιανουάριο.
	- Δεν χρειάζεται να υπάρχει event κάθε ημέρα του φεστιβάλ.
	- Ένα event πραγματοποιείται μόνο μία φορά.
	- Ένα performance πραγματοποιείται μόνο μία φορά σε ένα συγκεκριμένο event.
	- Τα performances δεν μπορούν να ξεκινάνε μετά τις 23:59. Δηλαδή, κάθε performance πρέπει να ξεκινάει την ίδια ημέρα με το αντίστοιχο event.
	- Τα performances ενός event πρέπει να γίνονται insert με την σωστή σειρά. Αυτό συμβαίνει για να μπορεί η Βάση αυτόματα να υπολογίζει το διάλειμμα μεταξύ δύο διαδοχικών performances και να βρίσκει αν είναι εντός των ορίων που θέλουμε.
	- Δεν μπορούν να αλλάξουν οι ημερομηνίες και οι ώρες ενός φεστιβάλ/ event/ performance από την στιγμή που αυτό εισαχθεί στην βάση.
	- Η Βάση δεν θα ελέγχει αυτόματα αν σε κάθε event έχει ανατεθεί ικανοποιητικό πλήθος προσωπικού. Ωστόσο, υπάρχει το Procedure checkEnoughStaff το οποίο θα το καλεί ο χρήστης για το event που τον ενδιαφέρει, ώστε να ελέγξει την πληρότητα του staff.
	- Η Βάση δεν υποθέτει ότι όλα τα εισιτήρια, ίδιου τύπου, για το ίδιο event έχουν την ίδια τιμή ή ότι ένα είδος εισιτηρίου πρέπει πάντα να έχει μεγαλύτερη τιμή από ένα άλλο, πχ το VIP να είναι πιο ακριβό από τα άλλα.
	- Οι ηλικίες του προσωπικού και των επισκεπτών του φεστιβάλ θεωρούνται ότι είναι με βάση την τρέχουσα χρονική στιγμή και δεν θα γίνεται αναδρομικός έλεγχος για προηγούμενα φεστιβάλ. Θεωρούμε ότι ο χρήστης έχει δώσει σωστά δεδομένα.
	- Δεν ελέγχεται αυτόματα αν κάποια σκηνή βρίσκεται πράγματι στην τοποθεσία που διεξάγεται το φεστιβάλ. Θεωρούμε ότι τα δεδομένα είναι σωστά.
	- Δεν ελέγχεται αυτόματα η ημερομηνία αγοράς του εισιτηρίου αν είναι σωστή. Θεωρούμε ότι τα δεδομένα είναι σωστά.
	- Οι φωτογραφίες και οι περιγραφές τους θα έχουν μία default τιμή και θα είναι ευθύνη του διαχειριστή της ιστοσελίδας του φεστιβάλ να βάλει κατάλληλα δεδομένα.
	- Οι φωτογραφίες δίνονται ως URL.
	- Τα μουσικά υποείδη είναι ανεξάρτητα από τα μουσικά είδη. Ένας καλλιτέχνης μπορεί να ανήκει σε περισσότερα από ένα.
	- Ένας επισκέπτης αν πουλήσει το εισιτήριό του και το ξαναγοράσει, δεν μπορεί να το διαθέσει ξανά για πώληση.


## Διάγραμμα ER
![442835768-d487a3f9-d2e8-41c3-b1a3-c8c6b203e333](https://github.com/user-attachments/assets/6163c910-c3d2-4f91-a98b-1da68397a72f)

![image](https://github.com/user-attachments/assets/f6c3b52c-0836-4b7b-9283-93251ac41bdc)


## Σχεσιακό Διάγραμμα
![image](https://github.com/user-attachments/assets/a1fbf8d9-9e26-4992-8c7d-b44d1a5f0e7d)

## Λειτουργίας βάσης δεδομένων
Αρχικά ο χρήστης τρέχει το αρχείο *sql/install.sql* που περιέχει τα tables, τα indexes, τα triggers και τα procedures.

Στη συνέχεια για την προσθήκη δεδομένων τρέχει το αρχείο *sql/load.sql*.

Παρέχονται αρχεία για την απάντηση των ερωτημάτων, καθώς και τα αποτελέσματα που επέστρεψαν.
Επίσης στον φάκελο *code* περιέχεται κώδικας python για την παραγωγή δεδομένων καθώς επίσης κι ένα αρχείο *demo.sql* το οποίο παρουσιάζει κάποιους από τους περιορισμούς που έχουμε υλοποιήσει και ένα παράδειγμα χρήσης της ουράς μεταπώλησης εισιτηρίων.

## Διαθέσιμα Procedure
Για την υλοποίηση διάφορων περιορισμών δημιουργήσαμε τα παρακάτω Procedures:

-  **checkEnoughStaff**(music_event_id): Ελέγχει ότι στο συγκεκριμένο event έχει ανατεθεί ικανοποιητικό πλήθος εργαζομένων.
-  **checkStaffOverlap**(staff_id, music_event_id): Ελέγχει ότι ο συγκεκριμένος υπάλληλος δεν δουλεύει την ίδια στιγμή που πραγματοποιήται ένα συγκεκριμένο event.
-  **checkStageOverlap**(music_event_id, perfStartTime, perfEndTime): Ελέγχει αν η σκηνή χρησιμοποιείται ήδη στα χρονικά πλαίσια *perfStartTime* και *perfEndTime*.
-  **checkArtistOverlap**(performer_id, music_event_id, perfStartTime, perfEndTime): Ελέγχει αν ένας συγκεκριμένος καλλιτέχνης εμφανίζεται ταυτόχρονα σε κάποια εμφάνιση μεταξύ των ωρών *perfStartTime* και *perfEndTime*.
-  **checkArtistStreak**(): Ελέγχει αν κάποιος από τους καλλιτέχνες που έχουμε προσθέσει μέχρι τώρα εμφανίζεται για πάνω από 3 συνεχόμενα φεστιβάλ.
-  **checkSoldOut**(music_event_id, OUT isSoldOut): Αν το event είναι sold-out επιστρέφει στην μεταβλητή isSoldOut 1, αλλιώς 0. 
-  **checkEAN**(ticket_code): Ελέγχει αν ο κωδικός *ticket_code* είναι δεκτός κωδικός EAN-13.
-  **findBuyer**(ticket_id, OUT result): Ψάχνει να βρει αν υπάρχει αγοραστής που ενδιαφέρεται για το συγκεκριμένο εισιτήριο. Αν ναι, επιστρέφει στο result 1, αλλιώς 0. Η αγορά πραγματοποιείται αυτόματα.
-  **findTicket**(buyer_id, music_event_id, ticketType_type, OUT result BIGINT): Ψάχνει να βρει αν υπάρχει διαθέσιμο εισιτήριο με αυτά τα δεδομένα. Αν ναι, επιστρέφει στο result 1, αλλιώς 0. Η αγορά πραγματοποιείται αυτόματα.

## Λειτουργία ουράς μεταπώλησης
Ένας επισκέπτης, ο οπίος διαθέτει NOT USED εισιτήριο για κάποια παράσταση μπορεί να διαθέσει το εισιτήριό του προς πώληση. Αυτό προϋποθέτει ότι η παράσταση έχει γίνει sold-out. Για να γίνει αυτό απλά πρέπει να γίνει INSERT στον seller οι τιμές (visitor_id, ticket_id).

Αν κάποιος επισκέπτης ενδιφέρεται να αγοράσει εισιτήριο, πρέπει να γίνει INSERT στον πίνακα buyer με τις τιμές visitor_id, music_event_id και ticket_type. Προαιρετικά, μπορεί να προσθέσει και ticket_id με την προϋπόθεση ότι αυτό το εισιτήριο είναι διαθέσιμο για πώληση.

Οι αγορές πραγματοποιούνται αυτόματα και τηρείται σειρά προτεραιότητας (FIFO).
